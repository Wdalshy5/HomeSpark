<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Smart Electro Power</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='Style.css') }}">
</head>
<body>

  <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
  <div class="top-bar">
    <span>WELCOME TO HomeSpark</span>
  </div>

  <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© -->
  <header class="navbar">
    <div class="logo">âš¡ï¸</div>
    <nav>
      <ul>
        <li><a href="#">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
        <li><a href="#">Ø§Ù„Ù…ØªØ¬Ø±</a></li>
        <li><a href="#">Ø§ØªØµÙ„ Ø¨Ù†Ø§</a></li>
      </ul>
    </nav>
    <div class="actions">
      <input type="text" placeholder="Ù…Ø§Ø°Ø§ ØªØ¨Ø­Ø« Ø¹Ù†ØŸ">
      <a href="#">ğŸ›’</a>
      <a href="#">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
    </div>
  </header>
  <!-- Render one carousel per category -->
  {% for cat in categories %}
    <h3 class="category-title">{{ cat }}</h3>
    <div class="carousel" data-category="{{ cat }}">
      <button class="carousel-button prev" aria-label="Ø§Ù„Ø³Ø§Ø¨Ù‚">â€¹</button>
      <div class="carousel-viewport">
        <ul class="carousel-track">
          {% for product in products %}
            {% if product.get('category','Uncategorized') == cat %}
            <li class="carousel-item" data-category="{{ cat }}" data-name="{{ product['name'] }}" data-desc="{{ product.get('detailed_description', product.get('description','')) }}" data-price="{{ product['price'] }}" data-img="{{ product.get('image','') }}">
              <div class="product-card" role="button" tabindex="0">
                <h2>{{ product['name'] }}</h2>
                <img src="{{ product['image'] }}" alt="{{ product['name'] }} image" class="dummie-img">
                
                <p class="product-description">{{ product['description'] }}</p>
                <p>Ø§Ù„Ø³Ø¹Ø±: {{ product['price'] }} Ø¯ÙˆÙ„Ø§Ø±</p>
              </div>
            </li>
            {% endif %}
          {% endfor %}
        </ul>
      </div>
      <button class="carousel-button next" aria-label="Ø§Ù„ØªØ§Ù„ÙŠ">â€º</button>
    </div>
  {% endfor %}

  <script>
  // Initialize each carousel separately
  document.addEventListener('DOMContentLoaded', function(){
    const carousels = Array.from(document.querySelectorAll('.carousel'));
    const isRTL = document.documentElement && document.documentElement.dir === 'rtl';

    function initCarousel(root){
      const track = root.querySelector('.carousel-track');
      let items = Array.from(root.querySelectorAll('.carousel-item'));
      const prev = root.querySelector('.carousel-button.prev');
      const next = root.querySelector('.carousel-button.next');
      const viewport = root.querySelector('.carousel-viewport');
      if(!track || items.length === 0) return;

      let index = 0;
      const perView = () => (window.innerWidth < 600 ? 1 : window.innerWidth < 900 ? 2 : 3);

      function setSizes(){
        const n = perView();
        const width = Math.floor(viewport.clientWidth / n);
        items.forEach(item => item.style.minWidth = width + 'px');
        if(items.length === 0){ track.style.transform = 'none'; return; }
        moveTo(index);
      }

      function moveTo(i){
        const maxIndex = Math.max(0, items.length - perView());
        if(i > maxIndex) i = 0;
        if(i < 0) i = maxIndex;
        index = i;
        const itemWidth = (items[0].getBoundingClientRect().width || Math.floor(viewport.clientWidth / perView()));
        const offset = itemWidth * index;
        const translateX = isRTL ? offset : -offset;
        track.style.transform = 'translateX(' + (translateX) + 'px)';
      }

      prev.addEventListener('click', ()=> moveTo(index - 1));
      next.addEventListener('click', ()=> moveTo(index + 1));

      window.addEventListener('resize', setSizes);
      setSizes();

      let autoplay = setInterval(()=> moveTo(index + 1), 3000);
      root.addEventListener('mouseenter', ()=> clearInterval(autoplay));
      root.addEventListener('mouseleave', ()=> { autoplay = setInterval(()=> moveTo(index + 1), 3000); });
    }

    carousels.forEach(initCarousel);
  });
  </script>

  <!-- Modal script: opens a product detail modal and blurs the background (delegated) -->
  <script>
  document.addEventListener('DOMContentLoaded', function(){
    // create modal DOM
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.id = 'productModal';
    modal.setAttribute('aria-hidden', 'true');
    modal.innerHTML = `
      <div class="modal-overlay" data-close></div>
      <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <button class="modal-close" aria-label="Close">Ã—</button>
        <div class="modal-body">
          <img class="modal-image" alt="product image" src="" />
          <h2 id="modalTitle"></h2>
          <p class="modal-desc"></p>
          <p class="modal-price"></p>
        </div>
      </div>`;
    document.body.appendChild(modal);

    function openModal(data){
      const modalEl = document.getElementById('productModal');
      modalEl.querySelector('.modal-image').src = data.img || '';
      modalEl.querySelector('#modalTitle').textContent = data.name || '';
      modalEl.querySelector('.modal-desc').textContent = data.desc || '';
      modalEl.querySelector('.modal-price').textContent = data.price ? ('Ø§Ù„Ø³Ø¹Ø±: ' + data.price + ' Ø¯ÙˆÙ„Ø§Ø±') : '';
      document.body.classList.add('modal-open');
      modalEl.classList.add('show');
      modalEl.setAttribute('aria-hidden', 'false');
      const closeBtn = modalEl.querySelector('.modal-close'); if(closeBtn) closeBtn.focus();
    }

    function closeModal(){
      const modalEl = document.getElementById('productModal');
      document.body.classList.remove('modal-open');
      modalEl.classList.remove('show');
      modalEl.setAttribute('aria-hidden', 'true');
    }

    // delegated click handler for product-card across all carousels
    document.addEventListener('click', (e)=>{
      const card = e.target.closest('.product-card');
      if(!card) return;
      const li = card.closest('.carousel-item');
      if(!li) return;
      openModal({name: li.dataset.name, desc: li.dataset.desc, price: li.dataset.price, img: li.dataset.img});
    });

    // keyboard support: open modal when focused product-card receives Enter or Space
    document.addEventListener('keydown', (e)=>{
      if(e.key !== 'Enter' && e.key !== ' ') return;
      const active = document.activeElement;
      if(active && active.classList && active.classList.contains('product-card')){
        const li = active.closest('.carousel-item');
        if(li) openModal({name: li.dataset.name, desc: li.dataset.desc, price: li.dataset.price, img: li.dataset.img});
      }
    });

    document.body.addEventListener('click', (e)=> { if(e.target.matches('[data-close]') || e.target.classList.contains('modal-close')) closeModal(); });
    document.addEventListener('keydown', (e)=> { if(e.key === 'Escape') closeModal(); });
  });
  </script>
</body>
</html>